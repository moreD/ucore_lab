# Lab2 Report

## 练习1

就是简单的first-fit算法。

初始化时在free链表中插入一个大小为n的块。

当分配空间时，遍历链表，找到第一个>=n的块，分配之。若有剩余，在原位置插入剩余的块。

当回收空间时，遍历链表找到该块内存的位置，将其放回并与前后的块合并（如果相邻）。

算法可以改进。回收空间时，其实可以通过一个辅助的平衡树之类的数据结构来加速定位而不需要遍历链表。

## 练习2

首先在页目录表中查找该内存对应的页表，若该页表还不存在，新建一个并设定对应的页目录表项。返回页表中该内存对应的页表项指针。

#### 请描述页目录项（Page Director Entry）和页表（Page Table Entry）中每个组成部分的含义和以及对ucore而言的潜在用处。

第0位是存在位。可用于判断该页表是否存在，若实现了虚存管理，当该位为0时就要到磁盘上读取该页表了。
第1位是读写位，第2位是U/S位可以限制非ring0程序对该位的读写操作。
第3位为PWT，标识该位是否为write-through。
第4位为PCD，标识是否开启cache。
第5位为访问位，当访问该页目录项时置1。可以用于页面置换算法。
第7位为页大小位，若该位为1，则使用4MB页大小。
从12位开始是页表地址。用来定位页表。

页表项与页目录项相比只有第6位不同。页表项的第6位是脏位，若有修改则置1。

#### 如果ucore执行过程中访问内存，出现了页访问异常，请问硬件要做哪些事情？

首先会记录下产生异常的线性地址（到CR2），并保存错误码到中断栈。然后启动标准的中断处理过程（压栈，跳转中断处理程序）

## 练习3

如果该页目录项存在，则将其引用数减一；若减到0则将对应的内存空间释放，并在TLB中删除该页表项。

#### 数据结构Page的全局变量（其实是一个数组）的每一项与页表中的页目录项和页表项有无对应关系？如果有，其对应关系是啥？

#### 如果希望虚拟地址与物理地址相等，则需要如何修改lab2，完成此事？



## 与参考答案的比较

first-fit中，参考答案似乎把每个页面都放入了链表中，而我只把有用的（即空闲块开头的页）放入链表。

## 知识点

1. 保护模式下的分段分页机制；
2. 内存管理分配的算法（first—fit、best-fit、worst-fit）